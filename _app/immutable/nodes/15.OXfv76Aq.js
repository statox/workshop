import{g as Vt,u as pt,a as qt,b as Ut}from"../chunks/api.Bh8ZevdC.js";import"../chunks/disclose-version.Bg9kRutz.js";import{p as P,aN as bt,k as U,n as z,g as t,s as B,aH as E,aY as kt,v as N,w as m,aF as f,aG as l,aE as Ft,aa as K,o as ht}from"../chunks/index-client.-dvqkx9U.js";import{s as F}from"../chunks/render.EdNHQRjW.js";import{e as R,i as H}from"../chunks/each.DdOvmIg7.js";import{m as ot,a as p,t as x,e as W,q as wt}from"../chunks/template.vTw7QF-h.js";import{c as Mt}from"../chunks/svelte-component.DflqVCH5.js";import{s as et,c as Ct,r as _t}from"../chunks/attributes.D4Azfxnv.js";import{t as yt,s as Lt,U as Ot,u as Et}from"../chunks/service.B0juS8IC.js";import{s as dt}from"../chunks/style.PwPRnE0L.js";import{b as Nt,d as jt}from"../chunks/input.Cv6oYycI.js";import{p as A}from"../chunks/proxy.DvpFO7AR.js";import{b as xt,s as St,a as ft}from"../chunks/store.Dou5SGBQ.js";import{m as It}from"../chunks/Modals.C9ed-w5r.js";import{a as Dt}from"../chunks/window.D9qWAAnJ.js";import{M as Rt}from"../chunks/Main.t0csPp8i.js";import{M as Ht}from"../chunks/Main.DYmk6Tx9.js";import{i as J}from"../chunks/if.CoTnXtBM.js";import{k as gt}from"../chunks/key.SZ_9xEFS.js";import{p as ct}from"../chunks/props.DeaVe1rt.js";import{b as Jt,g as Pt}from"../chunks/entry.DiZ7IED_.js";import{t as zt}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.CI_7SSHI.js";import{A as Gt}from"../chunks/index.CAR00_e-.js";import{b as Kt}from"../chunks/this.DiKMA1I5.js";import{a as Wt}from"../chunks/await.Dyj3nK-y.js";import"../chunks/legacy.B7rOiASK.js";import{p as Yt}from"../chunks/Main.svelte_svelte_type_style_lang.GeO9eQtV.js";const Qt=!1,Xt=async()=>({chords:await Vt()}),ga=Object.freeze(Object.defineProperty({__proto__:null,load:Xt,ssr:Qt},Symbol.toStringTag,{value:"Module"}));var Zt=x('<button class="top-link svelte-1kbb9q3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(_,e){P(e,!0);let o=E(0),s=E(!0),h;const S=a=>{a>0?B(s,!1):B(s,!0),h&&clearTimeout(h),h=setTimeout(()=>{B(s,!0)},3e3)},k=()=>{const a=document.documentElement.scrollTop||document.body.scrollTop;a>0&&(window.requestAnimationFrame(k),window.scrollTo(0,a-a/2))};bt(()=>S(t(o)));var r=Zt();r.__click=k,U(()=>yt(r,"hide",t(s))),Dt("y",()=>t(o),a=>B(o,A(a))),p(_,r),z()}ot(["click"]);const st=kt();let Tt=[];const mt=localStorage.getItem("failedVisitCounts");if(mt!==null)try{Tt=JSON.parse(mt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const lt=kt(Tt);lt.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const At=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,o)=>{try{await pt(e.chord.url);const s=Ft(st),h=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};h.count++,h.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,h),st.set(s)}catch(s){let h=s.message;s instanceof Gt&&s.code===401?h="Invalid logged in user":s instanceof Ot&&(h="User is logged out"),xt(lt,A([...o(),e.chord.url]));const S=`<strong>Visit not counted</strong><br/> ${h}`;zt.push(S,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=x('<span></span> <span><a target="_blank" rel="noopener noreferrer"></a></span>',1);function nt(_,e){P(e,!0);const[o,s]=St(),h=()=>ft(lt,"$failedVisitCounts",o);let S=ct(e,"showArtist",3,!1),k=E(void 0);st.subscribe(n=>{if(n&&n.has(e.chord.url)){const u=n.get(e.chord.url),i=new Date(u.lastAccessDateUnix*1e3);B(k,`visits: ${u.count} - last: ${i.toLocaleDateString()}`)}});const r=(S()?e.chord.artist+" - ":"")+e.chord.title,a=n=>n.type==="doc"?`${Jt}/docviewer/${n.url}`:n.url;var v=ee(),g=N(v);const b=K(()=>Ct(At(e.chord.type)));var L=m(g,2),c=f(L);U(()=>et(c,"href",a(e.chord))),c.__click=[te,e,h],c.textContent=r,l(L),U(()=>{Lt(g,t(b),"svelte-1yqqigs"),et(c,"title",t(k))}),p(_,v),z(),s()}ot(["click"]);var ae=x('<li class="ul2col-item"><!> <!></li>'),re=x('<ul class="ul2col-container"></ul>');function se(_,e){P(e,!0);let o=ct(e,"chords",15),s=E(void 0);st.subscribe(r=>{r&&(B(s,A(r)),o(o().sort((a,v)=>{const g=r.get(a.url),b=r.get(v.url);return g&&b?b.lastAccessDateUnix-g.lastAccessDateUnix:g?-1:b?1:a.artist!=v.artist?a.artist.toLowerCase()<v.artist.toLowerCase()?-1:1:a.title.toLowerCase()<v.title.toLowerCase()?-1:1})))});const h=(r,a,v)=>v[r.type]===!1?!1:a.length===0||r.artist.toLowerCase().match(a.toLowerCase())?!0:r.title.toLowerCase().match(a.toLowerCase());var S=W(),k=N(S);gt(k,o,r=>{var a=re();R(a,21,o,H,(v,g)=>{var b=W();const L=K(()=>{var u;return(u=t(s))==null?void 0:u.get(t(g).url)});var c=N(b);{var n=u=>{var i=ae(),d=f(i);{var w=y=>{var D=wt();U(()=>F(D,`(${t(L).count??""})`)),p(y,D)};J(d,y=>{t(L)&&y(w)})}var C=m(d,2);nt(C,{get chord(){return t(g)},showArtist:!0}),l(i),p(u,i)};J(c,u=>{h(t(g),e.searchString,e.filters)&&u(n)})}p(v,b)}),l(a),p(r,a)}),p(_,S),z()}const oe=(_,e)=>_<e?-1:_>e?1:0,Bt=(_,e)=>{const o=_.toLowerCase(),s=e.toLowerCase();return oe(o,s)};var ne=x('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=x('<li class="ul2col-item"><!></li>'),ie=x('<ul class="ul2col-container"></ul>'),ce=x('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=x('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){P(e,!0);let o=ct(e,"searchString",3,"");const s=e.chords.reduce((i,d)=>{const w=d.artist;return i[w]||(i[w]=[]),i[w].push(d),i},{}),h=[],S=Object.keys(s).sort(Bt).map((i,d,w)=>{if(d===0||i[0].toLowerCase()!=w[d-1][0].toLowerCase()){const C="anchor_letter_"+i[0];return h.push({letter:i[0],tag:C}),{name:i,tag:C}}return{name:i}});let k=E(0),r=E(0),a=E(void 0);const v=i=>{if(t(a)){var d=t(a).getBoundingClientRect();if(d.top<20){B(r,20);return}B(r,A(d.top))}};bt(()=>v(t(k)));const g=(i,d,w)=>s[i].sort((y,D)=>y.title<D.title?-1:1).filter(y=>{const D=y.type;return w[D]===!1?!1:d.length===0?!0:!!y.title.toLowerCase().match(d.toLowerCase())}),b=(i,d)=>!!i.toLowerCase().match(d.toLowerCase());var L=ue(),c=N(L);R(c,21,()=>h,H,(i,d)=>{var w=ne(),C=f(w),y=f(C,!0);U(()=>F(y,t(d).letter.toUpperCase())),l(C),l(w),U(()=>et(C,"href","#"+t(d).tag)),p(i,w)}),l(c);var n=m(c,2),u=f(n);R(u,21,()=>S,H,(i,d)=>{var w=W();const C=K(()=>g(t(d).name,o(),e.filters)),y=K(()=>b(t(d).name,o()));var D=N(w);{var j=M=>{var X=ce();const Z=K(()=>t(y)?s[t(d).name]:t(C));var Y=f(X),G=f(Y),$=m(G);gt($,o,at=>{var O=ie();R(O,21,()=>t(Z),H,(rt,Q)=>{var tt=le(),T=f(tt);nt(T,{get chord(){return t(Q)}}),l(tt),p(rt,tt)}),l(O),p(at,O)}),l(Y),l(X),U(()=>{et(Y,"id",t(d).tag),F(G,`${t(d).name??""} `)}),p(M,X)};J(D,M=>{(t(y)||t(C).length>0)&&M(j)})}p(i,w)}),l(u),l(n),Kt(n,i=>B(a,i),()=>t(a)),U(()=>dt(c,"--barTop",`${t(r)??""}px`)),Dt("y",()=>t(k),i=>B(k,A(i))),p(_,L),z()}var de=x('<li class="ul2col-item"><!></li>'),fe=x('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(_,e){P(e,!0);const o=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=A({});for(const k of e.chords)k.tags.forEach(a=>{s[a]||(s[a]=[]),s[a].push(k)});Object.keys(s).forEach(k=>{s[k].sort((r,a)=>{const v=r.artist.toLowerCase(),g=a.artist.toLowerCase(),b=r.title.toLowerCase(),L=a.title.toLowerCase();return v<g?-1:v>g?1:b<L?-1:1})});var h=W(),S=N(h);R(S,17,()=>Object.keys(s).sort(Bt),H,(k,r)=>{var a=W(),v=N(a);{var g=b=>{var L=fe(),c=f(L),n=f(c,!0);U(()=>F(n,o(t(r)))),l(c);var u=m(c,2);R(u,21,()=>s[t(r)],H,(i,d)=>{var w=W(),C=N(w);{var y=D=>{var j=de(),M=f(j);nt(M,{get chord(){return t(d)},showArtist:!0}),l(j),p(D,j)};J(C,D=>{e.filters[t(d).type]&&D(y)})}p(i,w)}),l(u),l(L),p(b,L)};J(v,b=>{(e.searchString.length===0||t(r).toLowerCase().match(e.searchString.toLowerCase()))&&b(g)})}p(k,a)}),p(_,h),z()}var ge=x('<li class="ul2col-item"><!> <!></li>'),_e=x('<ul class="ul2col-container"></ul>');function me(_,e){P(e,!0);let o=ct(e,"chords",15),s=E(void 0);st.subscribe(r=>{r&&(B(s,A(r)),o(o().sort((a,v)=>{const g=r.get(a.url),b=r.get(v.url);return g&&b?g.count!==b.count?b.count-g.count:b.lastAccessDateUnix-g.lastAccessDateUnix:g?-1:b?1:a.artist!=v.artist?a.artist.toLowerCase()<v.artist.toLowerCase()?-1:1:a.title.toLowerCase()<v.title.toLowerCase()?-1:1})))});const h=(r,a,v)=>v[r.type]===!1?!1:a.length===0||r.artist.toLowerCase().match(a.toLowerCase())?!0:r.title.toLowerCase().match(a.toLowerCase());var S=W(),k=N(S);gt(k,o,r=>{var a=_e();R(a,21,o,H,(v,g)=>{var b=W();const L=K(()=>{var u;return(u=t(s))==null?void 0:u.get(t(g).url)});var c=N(b);{var n=u=>{var i=ge(),d=f(i);{var w=y=>{var D=wt();U(()=>F(D,`(${t(L).count??""})`)),p(y,D)};J(d,y=>{t(L)&&y(w)})}var C=m(d,2);nt(C,{get chord(){return t(g)},showArtist:!0}),l(i),p(u,i)};J(c,u=>{h(t(g),e.searchString,e.filters)&&u(n)})}p(v,b)}),l(a),p(r,a)}),p(_,S),z()}var pe=x('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=x('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=x('<p style="color: red"> </p>'),we=x("<p>Fetching results...</p>"),Ce=x('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){P(e,!0);const o=r=>{const a=new Date(r.timestamp);return a.toDateString()+" "+a.toTimeString()},s=r=>r.fails.sort((a,v)=>a.chord.url<v.chord.url?-1:1);var h=W(),S=N(h);{var k=r=>{var a=Ce(),v=f(a),g=f(v),b=m(f(g));b.__click=function(...c){var n;(n=e.close)==null||n.apply(this,c)},l(g);var L=m(g,2);Wt(L,qt,c=>{var n=we();p(c,n)},(c,n)=>{var u=be();const i=K(()=>o(t(n))),d=K(()=>s(t(n)));var w=N(u),C=m(f(w),8),y=f(C,!0);l(C);var D=m(C,2),j=f(D,!0);l(D);var M=m(D,2),X=f(M,!0);l(M);var Z=m(M,2),Y=f(Z,!0);l(Z),l(w);var G=m(w,4),$=m(f(G),8);R($,17,()=>t(d),H,(at,O)=>{var rt=pe(),Q=N(rt),tt=f(Q,!0);l(Q);var T=m(Q,2),V=f(T);l(T);var q=m(T,2),I=f(q),ut=f(I,!0);l(I),l(q);var it=m(q,2),vt=f(it,!0);U(()=>F(vt,t(O).error?JSON.stringify(t(O).error):"")),l(it),U(()=>{F(tt,t(O).status),F(V,`${t(O).chord.artist??""} - ${t(O).chord.title??""}`),et(I,"href",t(O).chord.url),F(ut,new URL(t(O).chord.url).hostname)}),p(at,rt)}),l(G),U(()=>{F(y,t(i)),F(j,t(n).nbChecks),F(X,t(n).nbSkipped),F(Y,t(n).nbFails)}),p(c,u)},(c,n)=>{var u=ke(),i=f(u);l(u),U(()=>F(i,`Could not retrieve checks: ${t(n).message??""}`)),p(c,u)}),l(v),l(a),p(r,a)};J(S,r=>{e.isOpen&&r(k)})}p(_,h),z()}ot(["click"]);var Le=(_,e)=>e(),xe=x('<li class="ul2col-separator"> </li>'),Se=x('<!> <li class="ul2col-item"><!></li>',1),De=x('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){P(e,!0);const o=Date.now(),s=1e3*3600*24*7,h=s*4,S=[{label:"last week",time:o-s},{label:"one month ago",time:o-h},{label:"two months ago",time:o-2*h},{label:"six months ago",time:o-6*h},{label:"one year ago",time:o-12*h}],k=e.chords.filter(n=>n.creationDate).sort((n,u)=>u.creationDate-n.creationDate).map((n,u,i)=>{const d={...n};if(u>0){const w=i[u-1];for(const{time:C,label:y}of S)w.creationDate>C&&n.creationDate<C&&(d.dateTag=y)}return d});let r=6,a=E(A([]));const v=()=>{r+=4,B(a,A(k.slice(0,r)))};ht(()=>{v()});var g=De(),b=f(g),L=m(f(b));L.__click=[Le,v],l(b);var c=m(b,2);R(c,21,()=>t(a),H,(n,u)=>{var i=Se(),d=N(i);{var w=D=>{var j=xe(),M=f(j,!0);l(j),U(()=>F(M,t(u).dateTag)),p(D,j)};J(d,D=>{t(u).dateTag&&D(w)})}var C=m(d,2),y=f(C);nt(y,{get chord(){return t(u)}}),l(C),p(n,i)}),l(c),l(g),p(_,g),z()}ot(["click"]);const Ae=(_,e,o,s,h)=>{t(e).length<=o||(t(e).splice(t(e).length-o),B(s,A(t(e).slice(t(e).length-o).map(S=>h.chords[S]))))};var Be=x("<button>&nbspâ†¶&nbsp</button>"),Ve=x('<li class="ul2col-item"><!></li>'),qe=x('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br> <ul class="ul2col-container"></ul></div>');function Ue(_,e){P(e,!0);const o=6;let s=E(A([])),h=E(A([]));const S=()=>{t(s).length>=e.chords.length-o&&B(s,A([]));for(let c=0;c<o;c++){let n=-1;for(;n===-1||t(s).includes(n);)n=Math.floor(Math.random()*e.chords.length);t(s).push(n)}B(h,A(t(s).slice(t(s).length-o).map(c=>e.chords[c])))};ht(()=>{S()});var k=qe(),r=f(k),a=m(f(r)),v=f(a);{var g=c=>{var n=Be();n.__click=[Ae,s,o,h,e],p(c,n)};J(v,c=>{t(s).length>o&&c(g)})}var b=m(v,2);b.__click=S,l(a),l(r);var L=m(r,4);R(L,21,()=>t(h),c=>c.url,(c,n)=>{var u=Ve(),i=f(u);nt(i,{get chord(){return t(n)},showArtist:!0}),l(u),p(c,u)}),l(L),l(k),p(_,k),z()}ot(["click"]);var Fe=()=>It.open(ye),Me=()=>Pt("/songbook/edit"),Oe=(_,e)=>B(e,""),Ee=(_,e,o)=>{t(e)[t(o)]=!t(e)[t(o)],B(e,A(t(e)))},Ne=x('<button class="filter-control svelte-1gfqv35"><input type="checkbox"> <span></span></button>'),je=(_,e,o)=>B(e,A(t(o))),Ie=x('<button class="control svelte-1gfqv35"> </button>'),Re=x('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function _a(_,e){P(e,!0);const[o,s]=St(),h=()=>ft(lt,"$failedVisitCounts",o),S=()=>ft(Et,"$user",o);Yt.set("Songbook");const{chords:k}=e.data;let r=E(A([]));const a=T=>{t(r).push(T),B(r,A(t(r))),setTimeout(()=>{t(r).shift(),B(r,A(t(r)))},5e3)};ht(async()=>{try{if(h().length&&S()){a({level:"info",header:"Trying to count missed visits while logged out"});for(const T of h())await pt(T);a({level:"success",header:`Counted ${h().length} missed visits`}),xt(lt,A([]))}}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await Ut()).reduce((q,I)=>(q.set(I.url,{...I}),q),new Map);st.set(V)}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}});let v=E("");const g=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:me},{label:"By access date",component:se}];let b=E(A(g[0]));const L={pdf:!0,doc:!0,youtube:!0,link:!0};let c=E(A({...L}));const n=Object.keys(L);var u=Re(),i=N(u);Rt(i,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var d=m(i,2),w=f(d),C=f(w);C.__click=[Fe],dt(C,"position","relative");var y=m(C,2);y.__click=[Me],dt(y,"position","relative"),l(w),l(d);var D=m(d,2);R(D,17,()=>t(r),H,(T,V)=>{Ht(T,{get item(){return t(V)}})});var j=m(D,2);$t(j,{});var M=m(j,2),X=f(M);l(M);var Z=m(M,2);Te(Z,{chords:k});var Y=m(Z,2);Ue(Y,{chords:k});var G=m(Y,2),$=m(f(G),2);_t($);var at=m($,2);at.__click=[Oe,v];var O=m(at,2),rt=m(f(O),2);R(rt,17,()=>n,H,(T,V)=>{var q=Ne();q.__click=[Ee,c,V];var I=f(q);_t(I);var ut=m(I,2);const it=K(()=>Ct(At(t(V))));l(q),U(()=>{et(q,"aria-label",`filter for ${t(V)??""}`),et(I,"id",t(V)),Lt(ut,t(it),"svelte-1gfqv35")}),jt(I,()=>t(c)[t(V)],vt=>t(c)[t(V)]=vt),p(T,q)}),l(O);var Q=m(O,4);R(Q,21,()=>g,H,(T,V)=>{var q=Ie();q.__click=[je,b,V];var I=f(q,!0);l(q),U(()=>{yt(q,"selected",t(b)===t(V)),F(I,t(V).label)}),p(T,q)}),l(Q),l(G);var tt=m(G,2);Mt(tt,()=>t(b).component,(T,V)=>{V(T,{chords:k,get searchString(){return t(v)},get filters(){return t(c)}})}),U(()=>F(X,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Nt($,()=>t(v),T=>B(v,T)),p(_,u),z(),s()}ot(["click"]);export{_a as component,ga as universal};
